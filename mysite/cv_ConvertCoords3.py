#Adjust model coordinations for userImage

import numpy as np


class Converter:
    def __init__(self,shape_2d,vertices):
        self.USER = shape_2d
        self.MODEL = vertices

        self.ML_eye = [
            [-0.125613, 0.203985, -0.034877],[-0.126070, 0.206606, -0.035595],       
            [-0.127240, 0.212570, -0.037770],[-0.127900, 0.218473, -0.043529],      
            [-0.126828, 0.220915, -0.055001],[-0.124471, 0.219911, -0.066743],      
            [-0.121276, 0.215478, -0.073316],[-0.119368, 0.209665, -0.074832],         
            [-0.120874, 0.204520, -0.071404],[-0.123701, 0.200961, -0.064529],      
            [-0.125755, 0.199908, -0.055703],[-0.126767, 0.200423, -0.046974],        
            [-0.126468, 0.201571, -0.040394],[-0.125777, 0.202906, -0.036262]]
        self.MR_eye=[
            [-0.125902, 0.203985, 0.000834],[-0.126371, 0.206606, 0.001545],
            [-0.127576, 0.212570, 0.003700],[-0.128329, 0.218473, 0.009448],
            [-0.127443, 0.220915, 0.020936],[-0.125276, 0.219911, 0.032715],
            [-0.122188, 0.215478, 0.039338],[-0.120305, 0.209665, 0.040885],
            [-0.121756, 0.204520, 0.037434],[-0.124471, 0.200961, 0.030514],
            [-0.126381, 0.199908, 0.021655],[-0.127252, 0.200423, 0.012911],
            [-0.126846, 0.201571, 0.006337],[-0.126088, 0.202906, 0.002216]] 
        self.M_eye = self.ML_eye + self.MR_eye

        
        self.eye_idx = []
        for v in self.M_eye:
            idx = 0
            for m in self.MODEL:
                if v == m:
                    self.eye_idx.append(idx)
                idx = idx + 1    
        #self.eye_idx = [653, 1493, 465, 1452, 599, 1454, 597, 1450, 662, 1453, 801, 1455, 649, 1451, 1120, 1738, 949, 1672, 1072, 1674, 1070, 1670, 1126, 1673, 1258, 1675, 1118, 1671]
        print(self.eye_idx)

        
    # adjust Z coordinations
    def adjust_zx(self):
        if self.eye_type == 3:
            for i in self.eye_idx:
                self.MODEL[i][0] -= 0.003

            
        for v in range(len(self.MODEL)):
            self.MODEL[v][1] -= 0.2
            self.MODEL[v][2] += 0.017
        
            
        return self.MODEL



    
    def adjustEye(self):
        UL_eye = list(self.USER[48:54]) + list(self.USER[55:65]) + list(self.USER[66:70])
        UR_eye = list(self.USER[26:32]) + list(self.USER[33:43]) + list(self.USER[44:48])

        yc = []
        for y in UR_eye:
            yc.append(y[1])

        height =  max(yc) - UR_eye[0][1]
        distance = UR_eye[10][1] -  UR_eye[0][1]

        print(distance, height)
        print(distance / height * 100)

        self.eye_type = 2
        
        if distance / height * 100 >= 51:
            print("고양이눈")
            self.eye_type = 3
        elif distance / height * 100 <42:
            print('처진눈')
            self.eye_type = 1
        else:
            print('동그란 눈 or 일반적인 눈')
            self.eye_type = 2


        
        #type 1 처진 눈
        if self.eye_type == 1:
            self.ML_eye = [[-0.125613, 0.203985, -0.034877],[-0.12607, 0.206606, -0.035595],
                           [-0.12724, 0.21257, -0.03777],[-0.1279, 0.218473, -0.043529],
                           [-0.126828, 0.220915, -0.055001],[-0.124471, 0.218824, -0.066647],
                           [-0.121276, 0.211133, -0.072933],[-0.119368, 0.202636, -0.073937],
                           [-0.120874, 0.198129, -0.069743],[-0.123701, 0.196807, -0.062516],
                           [-0.125755, 0.197863, -0.054425],[-0.126767, 0.199912, -0.046655],
                           [-0.126468, 0.201571, -0.040394],[-0.125777, 0.202906, -0.036262]]

            
            self.MR_eye = [[-0.125902, 0.203985, 0.000834],[-0.126371, 0.206606, 0.001545],
                           [-0.127576, 0.21257, 0.0037],[-0.128329, 0.218473, 0.009448],
                           [-0.127443, 0.220915, 0.020936],[-0.125275, 0.218824, 0.032619],
                           [-0.122182, 0.211133, 0.038955],[-0.120291, 0.202636, 0.03999],
                           [-0.121729, 0.198129, 0.035772],[-0.124438, 0.196807, 0.028501],
                           [-0.126361, 0.197863, 0.020377],[-0.127247, 0.199912, 0.012592],
                           [-0.126846, 0.201571, 0.006337],[-0.126088, 0.202906, 0.002216]]


        # type 2 동그란 
        if self.eye_type == 2:
            self.ML_eye = [[-0.125613, 0.203985, -0.034877],[-0.126070, 0.206606, -0.035595],
                           [-0.127240, 0.212570, -0.037770],[-0.127900, 0.218473, -0.043529],
                           [-0.126828, 0.220915, -0.055001],[-0.124471, 0.219911, -0.066743],
                           [-0.121276, 0.215478, -0.073316],[-0.119368, 0.209665, -0.074832],
                           [-0.120874, 0.204520, -0.071404],[-0.123701, 0.200961, -0.064529],
                           [-0.125755, 0.199908, -0.055703],[-0.126767, 0.200423, -0.046974],
                           [-0.126468, 0.201571, -0.040394],[-0.125777, 0.202906, -0.036262]]
            
            self.MR_eye = [[-0.125902, 0.203985, 0.000834],[-0.126371, 0.206606, 0.001545],
                           [-0.127576, 0.212570, 0.003700],[-0.128329, 0.218473, 0.009448],
                           [-0.127443, 0.220915, 0.020936],[-0.125276, 0.219911, 0.032715],
                           [-0.122188, 0.215478, 0.039338],[-0.120305, 0.209665, 0.040885],
                           [-0.121756, 0.204520, 0.037434],[-0.124471, 0.200961, 0.030514],
                           [-0.126381, 0.199908, 0.021655],[-0.127252, 0.200423, 0.012911],
                           [-0.126846, 0.201571, 0.006337],[-0.126088, 0.202906, 0.002216]]
        # type 3 고양이 
        if self.eye_type == 3:
            self.ML_eye = [[-0.125613, 0.20187, -0.033467],[-0.12607, 0.205167, -0.034155],
                           [-0.12724, 0.211277, -0.035302],[-0.1279, 0.217886, -0.041825],
                           [-0.126828, 0.222677, -0.058644],[-0.124471, 0.222731, -0.070941],
                           [-0.121276, 0.215125, -0.075901],[-0.119368, 0.205934, -0.070601],
                           [-0.120874, 0.201229, -0.064119],[-0.123701, 0.199375, -0.057214],
                           [-0.125755, 0.198733, -0.05065],[-0.126767, 0.198866, -0.044448],
                           [-0.126468, 0.199338, -0.038631],[-0.125777, 0.200292, -0.034529]]
            
            self.MR_eye = [[-0.12588, 0.20187, -0.000576],[-0.126348, 0.205167, 0.000105],
                           [-0.127536, 0.211277, 0.001233],[-0.128301, 0.217886, 0.007745],
                           [-0.127502, 0.222677, 0.024578],[-0.125393, 0.222731, 0.036912],
                           [-0.12223, 0.215125, 0.041923],[-0.120237, 0.205934, 0.036655],
                           [-0.121638, 0.201229, 0.030149],[-0.124352, 0.199375, 0.023199],
                           [-0.1263, 0.198733, 0.016602],[-0.127211, 0.198866, 0.010385],
                           [-0.126818, 0.199338, 0.004574],[-0.12606, 0.200292, 0.000483]]

            '''
            self.ML_eye = [[-0.125613, 0.20187, -0.033467],[-0.12607, 0.205167, -0.034155],
                           [-0.12724, 0.211277, -0.035302],[-0.1279, 0.217886, -0.041825],
                           [-0.126828, 0.222677, -0.058644],[-0.124471, 0.222731, -0.073941],
                           [-0.121276, 0.215125, -0.075901],[-0.119368, 0.205934, -0.070601],
                           [-0.120874, 0.201229, -0.064119],[-0.123701, 0.199375, -0.057214],
                           [-0.125755, 0.198733, -0.05065],[-0.126767, 0.198866, -0.044448],
                           [-0.126468, 0.199338, -0.038631],[-0.125777, 0.200292, -0.034529]]
            
            self.MR_eye = [[-0.12588, 0.20187, -0.000576],[-0.126348, 0.205167, 0.000105],
                           [-0.127536, 0.211277, 0.001233],[-0.128301, 0.217886, 0.007745],
                           [-0.127502, 0.222677, 0.024578],[-0.125393, 0.222731, 0.039912],
                           [-0.12223, 0.215125, 0.041923],[-0.120237, 0.205934, 0.036655],
                           [-0.121638, 0.201229, 0.030149],[-0.124352, 0.199375, 0.023199],
                           [-0.1263, 0.198733, 0.016602],[-0.127211, 0.198866, 0.010385],
                           [-0.126818, 0.199338, 0.004574],[-0.12606, 0.200292, 0.000483]]
            '''

        self.M_eye = self.ML_eye + self.MR_eye
        num = 0
        for i in self.eye_idx:
            #print(self.MODEL[i])
            self.MODEL[i] = self.M_eye[num]
            num = num+1
                
        return self.MODEL
    
                
                
        
